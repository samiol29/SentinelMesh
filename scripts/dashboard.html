<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SENTINEL | CORE V6.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body { background-color: #050505; color: #d1d5db; font-family: 'JetBrains Mono', monospace;
               background-image: radial-gradient(#111 1px, transparent 1px); background-size: 30px 30px; }
        .tech-border { border: 1px solid #222; position: relative; background: rgba(10, 10, 10, 0.9); }
        .tech-border::before { content: ""; position: absolute; top: -1px; left: -1px; width: 10px; height: 10px; border-top: 2px solid #444; border-left: 2px solid #444; }
        .tech-border::after { content: ""; position: absolute; bottom: -1px; right: -1px; width: 10px; height: 10px; border-bottom: 2px solid #444; border-right: 2px solid #444; }
        .log-container { height: 320px; overflow-y: auto; scrollbar-width: none; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; }
        .healthy { background-color: #10b981; box-shadow: 0 0 8px #10b981; }
        .warning { background-color: #f59e0b; box-shadow: 0 0 8px #f59e0b; }
        .critical { background-color: #ef4444; box-shadow: 0 0 8px #ef4444; }
    </style>
</head>
<body class="p-8">
    <div class="flex justify-between items-end mb-10 border-b border-zinc-800 pb-6">
        <div>
            <div class="text-[10px] text-zinc-500 tracking-[0.5em] uppercase mb-1 font-bold">Network Defense Layer</div>
            <h1 class="text-2xl font-light uppercase">Sentinel<span class="font-bold text-white">Mesh</span></h1>
        </div>
        <div class="text-[10px] text-emerald-500 uppercase tracking-widest font-bold">Neural Link: Encrypted</div>
    </div>

    <div id="node-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10"></div>

    <div class="tech-border p-4">
        <div class="text-[10px] uppercase tracking-widest text-emerald-500/60 border-b border-zinc-800 pb-2 mb-4 font-bold">Core Intelligence Log</div>
        <div id="event-log" class="log-container space-y-3"></div>
    </div>

    <script>
        const ws = new WebSocket(`ws://${window.location.host}/ws`);
        const nodeGrid = document.getElementById('node-grid');
        const eventLog = document.getElementById('event-log');

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'stats') updateNodes(data.scores);
            if (data.type === 'resolution') updateLog(data.html);
        };

        function updateNodes(scores) {
            nodeGrid.innerHTML = '';
            Object.entries(scores).forEach(([name, data]) => {
                const shortName = name.replace('clab-sentinel-mesh-', '');
                const score = data.score;
                const lat = data.latency;
                
                let healthClass = 'text-emerald-500';
                let dot = 'healthy';
                if (score < 70) { healthClass = 'text-amber-500'; dot = 'warning'; }
                if (score < 30) { healthClass = 'text-red-500'; dot = 'critical'; }

                nodeGrid.insertAdjacentHTML('beforeend', `
                    <div class="tech-border p-6 transition-all hover:bg-zinc-900/40">
                        <div class="flex justify-between items-start mb-6">
                            <span class="text-[9px] uppercase tracking-widest text-zinc-500">${shortName}</span>
                            <span class="status-dot ${dot}"></span>
                        </div>
                        <div class="text-4xl font-light text-white mb-1">${score}%</div>
                        <div class="text-[9px] uppercase mb-4">
                            Latency: <span class="${healthClass} font-bold">${lat}ms</span>
                        </div>
                        <div class="bg-zinc-800 h-[1px] w-full"><div class="bg-white h-[1px]" style="width: ${score}%"></div></div>
                    </div>
                `);
            });
        }

        function updateLog(text) {
            const time = new Date().toLocaleTimeString('en-GB', { hour12: false });
            const entry = document.createElement('div');
            // Adding technical emerald accents
            entry.className = "p-3 border-l-2 border-emerald-500 bg-emerald-500/5 mb-3";
            entry.innerHTML = `
                <div class="text-[9px] text-emerald-500 font-bold mb-1 tracking-widest">[${time}] SYS_IMMUNE_EVENT</div>
                <div class="text-[11px] text-zinc-200 leading-relaxed">${text}</div>
            `;
            eventLog.prepend(entry);
        }
    </script>
</body>
</html>
